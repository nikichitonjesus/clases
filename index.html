<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Video SPA ¬∑ Reproductor</title>
    <style>
        /* ===== RESET Y VARIABLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #0a0f1e;
            color: #eef2fb;
            overflow-x: hidden;
        }
        :root {
            --header-height: 64px;
            --footer-mobile-height: 60px;
            --primary: #032D59;
            --accent: #4f9fff;
            --bg-dark: #0f1423;
            --card-bg: #1a1f30;
            --border-light: #2a2f42;
        }
        a {
            color: inherit;
            text-decoration: none;
        }
        /* ===== HEADER FIJO ===== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--header-height);
            background: var(--primary);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 12px;
            z-index: 1200;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }
        .menu-btn:hover { background: rgba(255,255,255,0.15); }
        .logo {
            height: 40px;
            width: auto;
            margin-right: 8px;
        }
        .search-bar {
            flex: 1;
            max-width: 600px;
            display: flex;
            background: rgba(255,255,255,0.15);
            border-radius: 40px;
            padding: 4px 12px;
            align-items: center;
            margin: 0 12px;
        }
        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            width: 100%;
            padding: 8px 4px;
            outline: none;
            font-size: 0.95rem;
        }
        .search-bar input::placeholder { color: #a0a8c0; }
        .search-bar button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 4px 8px;
        }
        .user-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .user-actions button {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        .user-actions button:hover { background: rgba(255,255,255,0.15); }
        .avatar {
            background: #4a6fa5;
            border-radius: 50%;
            font-weight: bold;
        }

        /* ===== PANEL LATERAL ===== */
        .side-panel {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100vh;
            background: #0b1225;
            z-index: 1300;
            transition: left 0.3s ease;
            padding: 80px 16px 24px;
            box-shadow: 4px 0 20px rgba(0,0,0,0.6);
            overflow-y: auto;
        }
        .side-panel.open { left: 0; }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1250;
            display: none;
        }
        .overlay.show { display: block; }
        .side-panel nav a {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 16px;
            border-radius: 12px;
            color: #ddd;
            font-size: 1.1rem;
            transition: background 0.2s;
            margin-bottom: 4px;
        }
        .side-panel nav a:hover {
            background: #1f2a44;
            color: white;
        }
        .side-panel nav a i { width: 24px; font-size: 1.3rem; }

        /* ===== CONTENIDO PRINCIPAL ===== */
        .main-content {
            margin-top: var(--header-height);
            padding: 20px;
            min-height: calc(100vh - var(--header-height));
            transition: filter 0.2s;
        }
        /* Ajuste para m√≥vil con barra inferior */
        @media (max-width: 768px) {
            .main-content { padding-bottom: calc(var(--footer-mobile-height) + 20px); }
        }

        /* ===== FILTROS DESLIZABLES ===== */
        .filters-container {
            position: relative;
            margin-bottom: 28px;
        }
        .filters-scroll {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 4px 0 12px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        .filters-scroll::-webkit-scrollbar { height: 4px; background: #2f354a; border-radius: 4px; }
        .filters-scroll::-webkit-scrollbar-thumb { background: #5f6a8a; border-radius: 4px; }
        .filter-chip {
            background: #1e2538;
            color: #ccd6f0;
            padding: 8px 20px;
            border-radius: 32px;
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            border: 1px solid #323b55;
            transition: all 0.2s;
            user-select: none;
        }
        .filter-chip.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        .scroll-btn {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 40px;
            background: rgba(10,15,30,0.8);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            backdrop-filter: blur(4px);
            opacity: 0;
            transition: opacity 0.2s;
            border-radius: 20px;
        }
        .filters-container:hover .scroll-btn { opacity: 1; }
        .scroll-btn.left { left: 0; }
        .scroll-btn.right { right: 0; }
        @media (max-width: 768px) { .scroll-btn { display: none; } }

        /* ===== GRID DE EPISODIOS ===== */
        .episodes-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px 16px;
        }
        @media (max-width: 1024px) { .episodes-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 768px) { .episodes-grid { grid-template-columns: 1fr; } }
        .episode-card {
            cursor: pointer;
            transition: transform 0.15s;
        }
        .episode-card:hover { transform: scale(1.02); }
        .thumbnail {
            position: relative;
            aspect-ratio: 16 / 9;
            background: #1e1e2f;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
        }
        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .episode-title {
            margin-top: 10px;
            font-weight: 500;
            font-size: 1rem;
            color: #f0f4ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .episode-title span:last-child { color: #9aa5c9; font-size: 0.8rem; }

        /* ===== REPRODUCTOR ===== */
        .player-section {
            margin-bottom: 30px;
            display: none; /* se muestra cuando hay un video activo */
        }
        .player-container {
            position: relative;
            background: black;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 30px rgba(0,0,0,0.8);
        }
        .player-video {
            width: 100%;
            display: block;
            background: black;
        }
        /* altura adaptable */
        .player-container {
            aspect-ratio: 16 / 9;
            max-height: 70vh;
        }
        @media (max-width: 768px) {
            .player-container { aspect-ratio: 16 / 9; max-height: 35vh; }
        }
        /* bot√≥n salir */
        .close-player {
            position: absolute;
            top: 16px;
            right: 20px;
            background: rgba(0,0,0,0.6);
            border: none;
            color: white;
            font-size: 28px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 50;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        /* controles centrales */
        .center-controls {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 30px;
            align-items: center;
            background: rgba(10,10,20,0.7);
            padding: 12px 30px;
            border-radius: 60px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.15);
            z-index: 40;
        }
        .center-controls button {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.2s;
        }
        .center-controls button:hover { background: rgba(255,255,255,0.2); }
        .center-controls img { width: 32px; height: 32px; filter: brightness(1.2); }

        /* barra inferior de controles */
        .player-controls-bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(0deg, rgba(0,0,0,0.9) 0%, transparent 100%);
            padding: 16px 20px 12px;
            z-index: 30;
        }
        .progress-bar {
            width: 100%;
            height: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 6px;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 5px;
            width: 0%;
        }
        .time-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #ccc;
            margin-bottom: 8px;
        }
        .bottom-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .left-buttons, .right-buttons {
            display: flex;
            gap: 18px;
            align-items: center;
        }
        .bottom-buttons button {
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
            position: relative;
        }
        .bottom-buttons button:hover { background: rgba(255,255,255,0.2); }
        .bottom-buttons img { width: 22px; height: 22px; filter: brightness(1.2); }
        /* sliders hover (volumen, velocidad) */
        .slider-popup {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1f30;
            padding: 12px 16px;
            border-radius: 30px;
            display: none;
            white-space: nowrap;
            box-shadow: 0 5px 15px black;
            border: 1px solid #3f4a6b;
        }
        .has-popup:hover .slider-popup { display: block; }
        .slider-popup input { width: 120px; cursor: pointer; }

        /* info bajo el reproductor */
        .player-meta {
            padding: 20px 0 10px;
        }
        .title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .title-row h2 { font-size: 1.5rem; }
        .action-buttons {
            display: flex;
            gap: 18px;
        }
        .action-buttons button {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            background: #1e253a;
            padding: 8px 14px;
            border-radius: 40px;
        }
        .action-buttons img { width: 22px; height: 22px; }
        .description {
            margin: 20px 0;
            background: #121728;
            padding: 18px;
            border-radius: 18px;
            line-height: 1.5;
        }
        .description .full { display: none; }
        .description.expanded .short { display: none; }
        .description.expanded .full { display: inline; }
        .read-more-btn {
            background: none;
            border: none;
            color: var(--accent);
            font-weight: 600;
            cursor: pointer;
            margin-left: 8px;
        }
        /* carruseles */
        .section-title {
            font-size: 1.3rem;
            margin: 30px 0 16px;
        }
        .carousel {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 8px 0 16px;
            scrollbar-width: thin;
        }
        .carousel .episode-card {
            flex: 0 0 220px;
        }
        @media (max-width: 768px) {
            .carousel .episode-card { flex: 0 0 160px; }
        }
        /* PIP flotante */
        .pip-player {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 280px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px black;
            z-index: 1100;
            display: none;
            border: 2px solid var(--accent);
            background: black;
        }
        @media (max-width: 768px) {
            .pip-player { bottom: 70px; width: 200px; }
        }
        .pip-player video { width: 100%; display: block; }

        /* ===== VISTAS (EXPLORAR, NOVEDADES, BIBLIOTECA) ===== */
        .view { display: none; }
        .view.active { display: block; }

        /* Novedades: top10 carrusel + grid */
        .top10-carousel {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            margin: 20px 0;
        }
        .top10-item { flex: 0 0 180px; }

        /* Biblioteca: secciones */
        .lib-section {
            background: #131826;
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .lib-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .btn-outline {
            background: none;
            border: 1px solid #5b6b9a;
            padding: 6px 16px;
            border-radius: 30px;
            color: white;
            cursor: pointer;
        }

        /* ===== BARRA INFERIOR M√ìVIL (proporcionada) ===== */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: env(safe-area-inset-bottom);
            left: 0;
            width: 100%;
            height: 60px;
            background: #032D59;
            border-top: none;
            border-radius: 0 0 6px 6px;
            z-index: 1000;
            padding: 0 4px;
            box-sizing: border-box;
        }
        .mobile-bottom-nav .nav-items {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            width: 100%;
        }
        .mobile-bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #FFFFFF;
            text-decoration: none;
            font-size: 11px;
            font-weight: 500;
            transition: transform 0.2s ease, background-color 0.2s ease;
            border-radius: 8px;
            flex: 1;
            min-width: 0;
            gap: 2px;
        }
        .mobile-bottom-nav .nav-item:hover,
        .mobile-bottom-nav .nav-item:active {
            transform: scale(1.05);
            background: rgba(0, 0, 0, 0.3);
        }
        .mobile-bottom-nav .nav-item img {
            width: 22px;
            height: 22px;
            flex-shrink: 0;
            filter: brightness(1.2);
        }
        .mobile-bottom-nav .nav-item span {
            line-height: 1.1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-shrink: 0;
        }
        @media only screen and (max-width: 768px) {
            .mobile-bottom-nav { display: block; }
        }
        @media only screen and (max-width: 320px) {
            .mobile-bottom-nav .nav-item { font-size: 10px; gap: 2px; padding: 0 4px; }
            .mobile-bottom-nav .nav-item img { width: 24px; height: 24px; }
            .mobile-bottom-nav { padding: 0 2px; }
        }
        @media only screen and (min-width: 321px) and (max-width: 480px) {
            .mobile-bottom-nav .nav-item { font-size: 11px; gap: 3px; padding: 0 6px; }
            .mobile-bottom-nav .nav-item img { width: 22px; height: 22px; }
        }
        @media only screen and (min-width: 481px) and (max-width: 768px) {
            .mobile-bottom-nav .nav-item { font-size: 12px; gap: 4px; padding: 0 8px; }
            .mobile-bottom-nav .nav-item img { width: 26px; height: 26px; }
            .mobile-bottom-nav { padding: 0 6px; }
        }
    </style>
    <!-- Iconos (usamos emoji temporalmente, pero puedes usar los enlaces dados en los botones) -->
</head>
<body>
    <!-- HEADER FIJO -->
    <header class="header">
        <button class="menu-btn" id="menuToggle">‚ò∞</button>
        <img class="logo" src="https://via.placeholder.com/100x40/032D59/ffffff?text=LOGO" alt="Logo">
        <div class="search-bar">
            <input type="text" placeholder="Buscar episodios...">
            <button>üîç</button>
        </div>
        <div class="user-actions">
            <button>üîî</button>
            <button class="avatar">üë§</button>
        </div>
    </header>

    <!-- PANEL LATERAL -->
    <div class="overlay" id="overlay"></div>
    <aside class="side-panel" id="sidePanel">
        <nav>
            <a href="#" data-view="inicio"><i>üè†</i> Inicio</a>
            <a href="#" data-view="explorar"><i>üîç</i> Explorar</a>
            <a href="#" data-view="novedades"><i>‚ú®</i> Novedades</a>
            <a href="#" data-view="biblioteca"><i>üìö</i> Biblioteca</a>
        </nav>
    </aside>

    <!-- PIP FLOTANTE -->
    <div class="pip-player" id="pipPlayer">
        <video id="pipVideo"></video>
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="main-content" id="mainContent">
        <!-- VISTA INICIO (FEED) -->
        <div id="viewInicio" class="view active">
            <div class="filters-container">
                <button class="scroll-btn left" id="filterScrollLeft">‚Äπ</button>
                <div class="filters-scroll" id="filterScroll"></div>
                <button class="scroll-btn right" id="filterScrollRight">‚Ä∫</button>
            </div>
            <div class="episodes-grid" id="episodesGrid"></div>
        </div>

        <!-- VISTA EXPLORAR (b√∫squeda) -->
        <div id="viewExplorar" class="view">
            <h2 style="margin-bottom:20px">Explorar</h2>
            <input type="text" placeholder="Buscar..." style="width:100%; padding:15px; background:#1f253a; border:none; border-radius:60px; color:white; margin-bottom:30px;" id="searchInput">
            <div class="episodes-grid" id="searchResults"></div>
        </div>

        <!-- VISTA NOVEDADES -->
        <div id="viewNovedades" class="view">
            <h2>Top 10</h2>
            <div class="top10-carousel" id="top10Carousel"></div>
            <h2 style="margin-top:40px">√öltimos episodios</h2>
            <div class="episodes-grid" id="latestGrid"></div>
        </div>

        <!-- VISTA BIBLIOTECA -->
        <div id="viewBiblioteca" class="view">
            <div class="lib-section">
                <div class="lib-header"><h3>En progreso</h3></div>
                <div class="carousel" id="progressCarousel"></div>
            </div>
            <div class="lib-section">
                <div class="lib-header"><h3>Favoritos</h3><button class="btn-outline" id="reorderFavs">Reordenar</button></div>
                <div class="episodes-grid" id="favoritesGrid"></div>
                <button class="btn-outline" style="margin-top:16px" id="viewAllFavs">Ver todo</button>
            </div>
            <div class="lib-section">
                <div class="lib-header"><h3>Historial</h3><button class="btn-outline" id="clearHistory">Vaciar</button></div>
                <div class="episodes-grid" id="historyGrid"></div>
            </div>
        </div>

        <!-- SECCI√ìN REPRODUCTOR (se inyecta cuando se reproduce algo) -->
        <div id="playerSection" class="player-section">
            <div class="player-container">
                <video id="mainVideo" class="player-video" controlslist="nodownload" disablepictureinpicture></video>
                <button class="close-player" id="closePlayerBtn">‚úï</button>
                <!-- Controles centrales -->
                <div class="center-controls">
                    <button id="seekBack"><img src="https://www.nikichitonjesus.com/web/image/438-deea748f/-10.webp" alt="-10"></button>
                    <button id="playPauseBtn"><img id="playPauseIcon" src="https://nikichitonjesus.odoo.com/web/image/715-d5d403f0/playvid.png" alt="play"></button>
                    <button id="seekForward"><img src="https://www.nikichitonjesus.com/web/image/439-9448d521/%2B10.webp" alt="+10"></button>
                </div>
                <!-- Barra inferior -->
                <div class="player-controls-bottom">
                    <div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill"></div></div>
                    <div class="time-row"><span id="currentTime">0:00</span><span id="duration">0:00</span></div>
                    <div class="bottom-buttons">
                        <div class="left-buttons">
                            <button id="prevBtn"><img src="https://video-nikichitonjesus.odoo.com/web/image/437-b1fd1bf4/anterior.webp" alt="anterior"></button>
                            <button id="nextBtn"><img src="https://video-nikichitonjesus.odoo.com/web/image/443-aa8bad56/otro.webp" alt="siguiente"></button>
                            <div class="has-popup">
                                <button id="volumeBtn"><img id="volumeIcon" src="https://nikichitonjesus.odoo.com/web/image/587-e4437449/volumen.png" alt="volumen"></button>
                                <div class="slider-popup"><input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="1"></div>
                            </div>
                            <div class="has-popup">
                                <button id="speedBtn"><img src="https://nikichitonjesus.odoo.com/web/image/637-65e36988/speed.png" alt="velocidad"></button>
                                <div class="slider-popup"><input type="range" id="speedSlider" min="0.5" max="2" step="0.1" value="1"></div>
                            </div>
                        </div>
                        <div class="right-buttons">
                            <button id="lockBtn">üîì</button>
                            <button id="fullscreenBtn"><img id="fullscreenIcon" src="https://nikichitonjesus.odoo.com/web/image/622-49c31be4/full.png" alt="full"></button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Metadatos del episodio -->
            <div class="player-meta">
                <div class="title-row">
                    <h2 id="videoTitle"></h2>
                    <div class="action-buttons">
                        <button id="favBtn"><img src="https://video-nikichitonjesus.odoo.com/web/image/445-ad116cfc/episodios.webp" alt="favorito"><span>Favorito</span></button>
                        <button id="shareBtn"><img src="https://nikichitonjesus.odoo.com/web/image/585-036b7961/cpmartir.png" alt="compartir"><span>Compartir</span></button>
                        <button id="downloadBtn"><img src="https://nikichitonjesus.odoo.com/web/image/624-ec376d7f/descargar.png" alt="descargar"><span>Descargar</span></button>
                        <button id="embedBtn"><img src="https://video-nikichitonjesus.odoo.com/web/image/622-10442ee4/pip.webp" alt="incrustar"><span>Incrustar</span></button>
                    </div>
                </div>
                <div class="description" id="descriptionBox">
                    <span class="short" id="descShort"></span>
                    <span class="full" id="descFull"></span>
                    <button class="read-more-btn" id="readMoreBtn">Leer m√°s</button>
                </div>
                <!-- Carrusel de serie (si aplica) -->
                <div id="serieCarouselContainer" style="display:none;">
                    <h3 class="section-title">Siguientes de la serie</h3>
                    <div class="carousel" id="serieCarousel"></div>
                </div>
                <!-- Relacionados aleatorios -->
                <h3 class="section-title">Relacionados</h3>
                <div class="carousel" id="relatedCarousel"></div>
            </div>
        </div>
    </main>

    <!-- BARRA INFERIOR M√ìVIL (se inyecta por JS, pero la dejamos fija en HTML para simplificar) -->
    <div class="mobile-bottom-nav">
        <div class="nav-items">
            <a href="#" class="nav-item" data-view="inicio" title="Home">
                <img src="https://media.baltaanay.org/web/image/798-1b947c8d/Home%20%282%29.webp" alt="Home" loading="lazy">
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" data-view="explorar" title="Explorar">
                <img src="https://www.baltaanay.org/web/image/986-2bf9d2bb/Search%20%282%29.webp" alt="Explorar" loading="lazy">
                <span>Explorar</span>
            </a>
            <a href="#" class="nav-item" title="Cargar">
                <img src="https://www.baltaanay.org/web/image/991-1c3c204a/subir.webp" alt="Cargar" loading="lazy">
                <span>Cargar</span>
            </a>
            <a href="#" class="nav-item" title="Solicitar">
                <img src="https://www.baltaanay.org/web/image/922-f3d79ca9/xhbalta-aula.png" alt="Solicitar" loading="lazy">
                <span>Solicitar</span>
            </a>
            <a href="#" class="nav-item" title="Usuario">
                <img src="https://nikichitonjesus3.odoo.com/web/image/453-f4d8c1eb/user.png" alt="Usuario" loading="lazy">
                <span>Portal</span>
            </a>
        </div>
    </div>

    <script>
        (function(){
            // ----------------------------------------------
            // 1. DATOS MOCK (EPISODIOS)
            // ----------------------------------------------
            const VIDEOS = [
                { id: 1, titulo: 'Introducci√≥n a la serie A', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?1', cover: 'https://picsum.photos/320/180?1', descripcion: 'Primer episodio de la serie A. Explicaci√≥n inicial.', serie: 'Serie A' },
                { id: 2, titulo: 'Segundo paso en la serie A', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?2', cover: 'https://picsum.photos/320/180?2', descripcion: 'Continuaci√≥n de la serie A.', serie: 'Serie A' },
                { id: 3, titulo: 'Episodio suelto 1', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?3', cover: 'https://picsum.photos/320/180?3', descripcion: 'Este es un episodio independiente.', serie: false },
                { id: 4, titulo: 'Episodio suelto 2', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?4', cover: 'https://picsum.photos/320/180?4', descripcion: 'Otro episodio sin serie.', serie: false },
                { id: 5, titulo: 'Serie B - Cap√≠tulo 1', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?5', cover: 'https://picsum.photos/320/180?5', descripcion: 'Inicio de la serie B.', serie: 'Serie B' },
                { id: 6, titulo: 'Serie B - Cap√≠tulo 2', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?6', cover: 'https://picsum.photos/320/180?6', descripcion: 'Segundo de la serie B.', serie: 'Serie B' },
                { id: 7, titulo: 'Especial', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?7', cover: 'https://picsum.photos/320/180?7', descripcion: 'Episodio √∫nico muy visto.', serie: false },
                { id: 8, titulo: 'Aventura X', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?8', cover: 'https://picsum.photos/320/180?8', descripcion: 'Contenido variado.', serie: false },
                { id: 9, titulo: 'Serie C - Piloto', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?9', cover: 'https://picsum.photos/320/180?9', descripcion: 'Primero de la serie C.', serie: 'Serie C' },
                { id: 10, titulo: 'Serie C - Segundo', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?10', cover: 'https://picsum.photos/320/180?10', descripcion: 'Segundo de la serie C.', serie: 'Serie C' },
                { id: 11, titulo: 'Serie C - Final', url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/1080/Big_Buck_Bunny_1080_10s_1MB.mp4?11', cover: 'https://picsum.photos/320/180?11', descripcion: 'Final de la serie C.', serie: 'Serie C' },
            ];

            // ----------------------------------------------
            // 2. ESTADO GLOBAL
            // ----------------------------------------------
            let currentView = 'inicio';
            let currentVideoId = null;            // id del video en reproducci√≥n (o null si no hay)
            let currentSerieEpisodes = [];         // episodios de la misma serie (ordenados)
            let allEpisodes = VIDEOS;               // referencia
            let filteredEpisodes = [...VIDEOS];     // para el feed
            let activeFilter = 'todo';
            let isPlayerVisible = false;
            let isPipActive = false;
            let isLocked = false;                   // bloquear controles
            let favoriteIds = JSON.parse(localStorage.getItem('favorites')) || [];
            let history = JSON.parse(localStorage.getItem('history')) || [];   // guarda objetos {id, time, duration} (el √∫ltimo tiempo)
            let inProgress = JSON.parse(localStorage.getItem('inProgress')) || [];

            // Elementos DOM
            const mainVideo = document.getElementById('mainVideo');
            const pipVideo = document.getElementById('pipVideo');
            const playerSection = document.getElementById('playerSection');
            const pipDiv = document.getElementById('pipPlayer');
            const viewInicio = document.getElementById('viewInicio');
            const viewExplorar = document.getElementById('viewExplorar');
            const viewNovedades = document.getElementById('viewNovedades');
            const viewBiblioteca = document.getElementById('viewBiblioteca');
            const episodesGrid = document.getElementById('episodesGrid');
            const filterScroll = document.getElementById('filterScroll');
            const menuToggle = document.getElementById('menuToggle');
            const sidePanel = document.getElementById('sidePanel');
            const overlay = document.getElementById('overlay');

            // ----------------------------------------------
            // 3. FUNCIONES AUXILIARES
            // ----------------------------------------------
            function shuffleArray(arr) { return arr.sort(() => Math.random() - 0.5); }
            function sortBySerieThenId(episodes) {
                // agrupar por serie, y dentro de cada serie ordenar por id ascendente
                const series = {};
                episodes.forEach(ep => {
                    if (ep.serie) {
                        if (!series[ep.serie]) series[ep.serie] = [];
                        series[ep.serie].push(ep);
                    }
                });
                // Para la vista 'serie': necesitamos el primer episodio de cada serie (el de menor id)
                const firstOfEachSerie = [];
                Object.values(series).forEach(list => {
                    list.sort((a,b) => a.id - b.id);
                    firstOfEachSerie.push(list[0]); // el primero
                });
                return firstOfEachSerie;
            }

            // Obtener categor√≠as √∫nicas (basadas en el campo 'serie' y adem√°s 'todo' y 'serie' fijos)
            function getCategories() {
                let cats = new Set();
                VIDEOS.forEach(v => { if (v.serie) cats.add(v.serie); });
                let catsArray = Array.from(cats);
                catsArray = shuffleArray(catsArray); // orden aleatorio
                return ['todo', 'serie', ...catsArray];
            }

            // Filtrar episodios seg√∫n categor√≠a
            function filterEpisodes(category) {
                if (category === 'todo') return [...VIDEOS];
                if (category === 'serie') return sortBySerieThenId(VIDEOS); // primeros de cada serie
                // categor√≠a es nombre de serie
                return VIDEOS.filter(v => v.serie === category).sort((a,b) => a.id - b.id);
            }

            // Renderizar grid de episodios (contenedor, lista)
            function renderGrid(container, episodes) {
                if (!container) return;
                container.innerHTML = '';
                episodes.forEach(ep => {
                    const card = document.createElement('div');
                    card.className = 'episode-card';
                    card.dataset.id = ep.id;
                    card.innerHTML = `
                        <div class="thumbnail"><img src="${ep.cover}" loading="lazy"></div>
                        <div class="episode-title"><span>${ep.titulo}</span><span>${ep.serie || 'Suelto'}</span></div>
                    `;
                    card.addEventListener('click', (e) => {
                        e.stopPropagation();
                        playVideoById(ep.id);
                    });
                    container.appendChild(card);
                });
            }

            // Renderizar feed con filtro activo
            function refreshFeed() {
                filteredEpisodes = filterEpisodes(activeFilter);
                renderGrid(episodesGrid, filteredEpisodes);
            }

            // Renderizar filtros
            function renderFilters() {
                const cats = getCategories();
                filterScroll.innerHTML = '';
                cats.forEach(cat => {
                    const chip = document.createElement('span');
                    chip.className = `filter-chip ${cat === activeFilter ? 'active' : ''}`;
                    chip.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
                    chip.dataset.filter = cat;
                    chip.addEventListener('click', () => {
                        activeFilter = cat;
                        renderFilters();
                        refreshFeed();
                    });
                    filterScroll.appendChild(chip);
                });
            }

            // Reproducir video por ID (actualiza URL, player, etc)
            function playVideoById(id) {
                const video = VIDEOS.find(v => v.id === id);
                if (!video) return;
                currentVideoId = id;
                // Actualizar hash para enrutamiento
                window.location.hash = `#/video/${id}`;
                // Mostrar player secci√≥n
                playerSection.style.display = 'block';
                isPlayerVisible = true;
                // Ocultar otras vistas (feed y dem√°s) - pero no las ocultamos, solo el player aparece arriba
                // En nuestra estructura, el player est√° dentro del main, pero queremos que se vea sobre el feed.
                // Para simplificar, el player se muestra y el feed sigue abajo.
                // Pero en la especificaci√≥n, al reproducir se debe ver el reproductor y luego el feed de relacionados, etc. Eso ya est√°.
                // Ocultar el PIP si estaba
                pipDiv.style.display = 'none';
                if (isPipActive) { pipVideo.pause(); isPipActive = false; }

                // Cargar video en reproductor principal
                mainVideo.src = video.url;
                mainVideo.load();
                mainVideo.play().catch(e => console.log('Autoplay bloqueado'));

                // Actualizar metadatos
                document.getElementById('videoTitle').textContent = video.titulo;
                document.getElementById('descShort').textContent = video.descripcion.substring(0, 100) + '...';
                document.getElementById('descFull').textContent = video.descripcion;

                // Manejar serie
                if (video.serie) {
                    currentSerieEpisodes = VIDEOS.filter(v => v.serie === video.serie).sort((a,b) => a.id - b.id);
                    const serieCarousel = document.getElementById('serieCarousel');
                    renderGrid(serieCarousel, currentSerieEpisodes.filter(ep => ep.id !== id)); // no mostrar el actual
                    document.getElementById('serieCarouselContainer').style.display = 'block';
                } else {
                    document.getElementById('serieCarouselContainer').style.display = 'none';
                    currentSerieEpisodes = [];
                }

                // Relacionados aleatorios (excluyendo el actual)
                let relacionados = VIDEOS.filter(v => v.id !== id);
                relacionados = shuffleArray(relacionados).slice(0, 10);
                renderGrid(document.getElementById('relatedCarousel'), relacionados);

                // Media Session API
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: video.titulo,
                        artist: video.serie || 'Episodio suelto',
                        album: 'Video SPA',
                        artwork: [{ src: video.cover, sizes: '512x512', type: 'image/jpg' }]
                    });
                    // Acciones
                    navigator.mediaSession.setActionHandler('play', () => mainVideo.play());
                    navigator.mediaSession.setActionHandler('pause', () => mainVideo.pause());
                    navigator.mediaSession.setActionHandler('previoustrack', () => { if (currentSerieEpisodes.length) { let idx = currentSerieEpisodes.findIndex(e => e.id === currentVideoId); if (idx > 0) playVideoById(currentSerieEpisodes[idx-1].id); } });
                    navigator.mediaSession.setActionHandler('nexttrack', () => { if (currentSerieEpisodes.length) { let idx = currentSerieEpisodes.findIndex(e => e.id === currentVideoId); if (idx < currentSerieEpisodes.length-1) playVideoById(currentSerieEpisodes[idx+1].id); } });
                }

                // Actualizar bot√≥n favorito
                updateFavButton();
            }

            function updateFavButton() {
                const favBtn = document.getElementById('favBtn');
                if (favoriteIds.includes(currentVideoId)) {
                    favBtn.innerHTML = '<img src="https://video-nikichitonjesus.odoo.com/web/image/620-c48f85cd/agregado.webp" alt="favorito"><span>Quitar</span>';
                } else {
                    favBtn.innerHTML = '<img src="https://video-nikichitonjesus.odoo.com/web/image/445-ad116cfc/episodios.webp" alt="favorito"><span>Favorito</span>';
                }
            }

            // ----------------------------------------------
            // 4. ENRUTAMIENTO (hash)
            // ----------------------------------------------
            function handleRoute() {
                const hash = window.location.hash.slice(1) || '/';
                if (hash.startsWith('/video/')) {
                    const id = parseInt(hash.split('/')[2]);
                    if (!isNaN(id) && VIDEOS.some(v => v.id === id)) {
                        playVideoById(id);
                    } else {
                        // No encontrado, redirigir a inicio
                        window.location.hash = '#/';
                    }
                } else {
                    // Ruta normal: mostrar vista correspondiente
                    const path = hash.split('/')[1] || 'inicio';
                    showView(path);
                }
            }

            function showView(viewName) {
                // Ocultar todas las vistas
                viewInicio.classList.remove('active');
                viewExplorar.classList.remove('active');
                viewNovedades.classList.remove('active');
                viewBiblioteca.classList.remove('active');
                if (viewName === 'inicio') viewInicio.classList.add('active');
                if (viewName === 'explorar') viewExplorar.classList.add('active');
                if (viewName === 'novedades') viewNovedades.classList.add('active');
                if (viewName === 'biblioteca') viewBiblioteca.classList.add('active');
                currentView = viewName;

                // Si es novedades, renderizar
                if (viewName === 'novedades') {
                    // Top 10 (ordenado por id descendente)
                    const top10 = [...VIDEOS].sort((a,b) => b.id - a.id).slice(0,10);
                    renderGrid(document.getElementById('top10Carousel'), top10);
                    // √öltimos 12
                    const latest = [...VIDEOS].sort((a,b) => b.id - a.id).slice(0,12);
                    renderGrid(document.getElementById('latestGrid'), latest);
                }
                if (viewName === 'biblioteca') {
                    renderBiblioteca();
                }
                if (viewName === 'explorar') {
                    document.getElementById('searchResults').innerHTML = '';
                }
            }

            function renderBiblioteca() {
                // En progreso: episodios con tiempo guardado pero no terminados (menos del 95%)
                const progEp = inProgress.filter(p => p.percent < 0.95).map(p => VIDEOS.find(v => v.id === p.id)).filter(v => v);
                renderGrid(document.getElementById('progressCarousel'), progEp);
                // Favoritos
                const favEp = favoriteIds.map(id => VIDEOS.find(v => v.id === id)).filter(v => v);
                renderGrid(document.getElementById('favoritesGrid'), favEp.slice(0,6));
                // Historial (√∫ltimos vistos)
                const histEp = history.slice(-10).reverse().map(h => VIDEOS.find(v => v.id === h.id)).filter(v => v);
                renderGrid(document.getElementById('historyGrid'), histEp);
            }

            // ----------------------------------------------
            // 5. EVENTOS Y CONTROL DE REPRODUCTOR
            // ----------------------------------------------
            // Play/Pause
            document.getElementById('playPauseBtn').addEventListener('click', () => {
                if (mainVideo.paused) mainVideo.play();
                else mainVideo.pause();
            });
            mainVideo.addEventListener('play', () => {
                document.getElementById('playPauseIcon').src = 'https://nikichitonjesus.odoo.com/web/image/716-c7a68f34/pausevid.png';
            });
            mainVideo.addEventListener('pause', () => {
                document.getElementById('playPauseIcon').src = 'https://nikichitonjesus.odoo.com/web/image/715-d5d403f0/playvid.png';
            });

            // Seek
            document.getElementById('seekBack').addEventListener('click', () => { mainVideo.currentTime -= 10; });
            document.getElementById('seekForward').addEventListener('click', () => { mainVideo.currentTime += 10; });

            // Barra de progreso
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            mainVideo.addEventListener('timeupdate', () => {
                if (mainVideo.duration) {
                    const percent = (mainVideo.currentTime / mainVideo.duration) * 100;
                    progressFill.style.width = percent + '%';
                    document.getElementById('currentTime').textContent = formatTime(mainVideo.currentTime);
                    document.getElementById('duration').textContent = formatTime(mainVideo.duration);
                    // Guardar progreso en inProgress
                    const existing = inProgress.findIndex(p => p.id === currentVideoId);
                    const prog = { id: currentVideoId, time: mainVideo.currentTime, duration: mainVideo.duration, percent: mainVideo.currentTime/mainVideo.duration };
                    if (existing >= 0) inProgress[existing] = prog;
                    else inProgress.push(prog);
                    localStorage.setItem('inProgress', JSON.stringify(inProgress));
                }
            });
            progressBar.addEventListener('click', (e) => {
                const rect = progressBar.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                mainVideo.currentTime = pos * mainVideo.duration;
            });

            function formatTime(sec) {
                let h = Math.floor(sec/3600);
                let m = Math.floor((sec%3600)/60);
                let s = Math.floor(sec%60);
                if (h>0) return `${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                return `${m}:${s.toString().padStart(2,'0')}`;
            }

            // Volumen
            const volumeSlider = document.getElementById('volumeSlider');
            volumeSlider.addEventListener('input', () => {
                mainVideo.volume = volumeSlider.value;
                // cambiar icono si mute
            });

            // Velocidad
            document.getElementById('speedSlider').addEventListener('input', (e) => {
                mainVideo.playbackRate = e.target.value;
            });

            // Anterior/Siguiente (para serie)
            document.getElementById('prevBtn').addEventListener('click', () => {
                if (!currentSerieEpisodes.length) return;
                let idx = currentSerieEpisodes.findIndex(e => e.id === currentVideoId);
                if (idx > 0) playVideoById(currentSerieEpisodes[idx-1].id);
            });
            document.getElementById('nextBtn').addEventListener('click', () => {
                if (!currentSerieEpisodes.length) return;
                let idx = currentSerieEpisodes.findIndex(e => e.id === currentVideoId);
                if (idx < currentSerieEpisodes.length-1) playVideoById(currentSerieEpisodes[idx+1].id);
            });

            // Lock controles
            let lockBtn = document.getElementById('lockBtn');
            lockBtn.addEventListener('click', () => {
                isLocked = !isLocked;
                lockBtn.textContent = isLocked ? 'üîí' : 'üîì';
                // Deshabilitar todos los botones excepto lock y fullscreen? (simplificado)
            });

            // Fullscreen
            document.getElementById('fullscreenBtn').addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.querySelector('.player-container').requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            });

            // Salir del reproductor (cerrar vista de player)
            document.getElementById('closePlayerBtn').addEventListener('click', () => {
                playerSection.style.display = 'none';
                isPlayerVisible = false;
                // Activar PIP con el video actual
                if (!mainVideo.paused) {
                    pipVideo.src = mainVideo.src;
                    pipVideo.currentTime = mainVideo.currentTime;
                    pipVideo.play();
                    pipDiv.style.display = 'block';
                    isPipActive = true;
                }
                // mainVideo.pause(); // no paramos, pasa a PIP
            });

            // Favoritos
            document.getElementById('favBtn').addEventListener('click', () => {
                if (favoriteIds.includes(currentVideoId)) {
                    favoriteIds = favoriteIds.filter(id => id !== currentVideoId);
                } else {
                    favoriteIds.push(currentVideoId);
                }
                localStorage.setItem('favorites', JSON.stringify(favoriteIds));
                updateFavButton();
            });

            // Compartir (simulado)
            document.getElementById('shareBtn').addEventListener('click', () => {
                navigator.clipboard?.writeText(window.location.href);
                alert('Enlace copiado al portapapeles');
            });

            // Descargar (simulado)
            document.getElementById('downloadBtn').addEventListener('click', () => {
                const a = document.createElement('a');
                a.href = VIDEOS.find(v=>v.id===currentVideoId).url;
                a.download = 'video.mp4';
                a.click();
            });

            // Incrustar
            document.getElementById('embedBtn').addEventListener('click', () => {
                const embedCode = `<iframe src="${window.location.origin}/embed/${currentVideoId}" width="560" height="315" frameborder="0"></iframe>`;
                navigator.clipboard?.writeText(embedCode);
                alert('C√≥digo de incrustaci√≥n copiado');
            });

            // Leer m√°s
            document.getElementById('readMoreBtn').addEventListener('click', () => {
                document.getElementById('descriptionBox').classList.toggle('expanded');
            });

            // Scroll filtros
            document.getElementById('filterScrollLeft').addEventListener('click', () => {
                filterScroll.scrollBy({ left: -200, behavior: 'smooth' });
            });
            document.getElementById('filterScrollRight').addEventListener('click', () => {
                filterScroll.scrollBy({ left: 200, behavior: 'smooth' });
            });

            // Men√∫ lateral
            menuToggle.addEventListener('click', () => {
                sidePanel.classList.add('open');
                overlay.classList.add('show');
            });
            overlay.addEventListener('click', () => {
                sidePanel.classList.remove('open');
                overlay.classList.remove('show');
            });

            // Navegaci√≥n desde panel y barra m√≥vil
            document.querySelectorAll('[data-view]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const view = link.dataset.view;
                    window.location.hash = view === 'inicio' ? '#/' : `#/${view}`;
                    sidePanel.classList.remove('open');
                    overlay.classList.remove('show');
                });
            });

            // Buscador en explorar
            document.getElementById('searchInput').addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const results = VIDEOS.filter(v => v.titulo.toLowerCase().includes(term) || (v.serie && v.serie.toLowerCase().includes(term)));
                renderGrid(document.getElementById('searchResults'), results);
            });

            // Vaciar historial
            document.getElementById('clearHistory')?.addEventListener('click', () => {
                history = [];
                localStorage.setItem('history', JSON.stringify(history));
                renderBiblioteca();
            });

            // Reordenar favoritos (simulado)
            document.getElementById('reorderFavs')?.addEventListener('click', () => {
                alert('Funci√≥n reordenar (implementar drag&drop)');
            });

            // Ver todos los favoritos
            document.getElementById('viewAllFavs')?.addEventListener('click', () => {
                const favEp = favoriteIds.map(id => VIDEOS.find(v => v.id === id)).filter(v => v);
                renderGrid(document.getElementById('favoritesGrid'), favEp);
            });

            // Scroll: activar PIP si el reproductor sale de la vista
            window.addEventListener('scroll', () => {
                if (!isPlayerVisible || isPipActive) return;
                const rect = playerSection.getBoundingClientRect();
                if (rect.bottom < 0 || rect.top > window.innerHeight) {
                    // Fuera de pantalla
                    if (!mainVideo.paused) {
                        pipVideo.src = mainVideo.src;
                        pipVideo.currentTime = mainVideo.currentTime;
                        pipVideo.play();
                        pipDiv.style.display = 'block';
                        isPipActive = true;
                    }
                } else {
                    // Dentro de pantalla, ocultar PIP si estaba activo
                    if (isPipActive) {
                        pipDiv.style.display = 'none';
                        pipVideo.pause();
                        isPipActive = false;
                    }
                }
            });

            // Al terminar el video, pasar al siguiente de la serie si existe
            mainVideo.addEventListener('ended', () => {
                if (currentSerieEpisodes.length) {
                    let idx = currentSerieEpisodes.findIndex(e => e.id === currentVideoId);
                    if (idx < currentSerieEpisodes.length-1) {
                        playVideoById(currentSerieEpisodes[idx+1].id);
                    } else {
                        // Si es el √∫ltimo, reproducir relacionado aleatorio
                        let randomRel = VIDEOS.filter(v => v.id !== currentVideoId);
                        randomRel = shuffleArray(randomRel);
                        if (randomRel.length) playVideoById(randomRel[0].id);
                    }
                } else {
                    // Episodio suelto, reproducir relacionado aleatorio
                    let randomRel = VIDEOS.filter(v => v.id !== currentVideoId);
                    randomRel = shuffleArray(randomRel);
                    if (randomRel.length) playVideoById(randomRel[0].id);
                }
            });

            // Inicializaci√≥n
            renderFilters();
            refreshFeed();

            // Escuchar cambios de hash
            window.addEventListener('hashchange', handleRoute);
            if (!window.location.hash || window.location.hash === '#') {
                window.location.hash = '#/';
            } else {
                handleRoute();
            }

            // Inyectar barra m√≥vil (ya est√° en HTML, pero aseguramos visibilidad con JS)
            // La barra ya est√° en el HTML fijo, no hace falta inyectar.

            // Registrar en historial al iniciar reproducci√≥n (se puede hacer en playVideoById)
            function addToHistory(id) {
                history.push({ id, timestamp: Date.now() });
                if (history.length > 50) history.shift();
                localStorage.setItem('history', JSON.stringify(history));
            }
            // Llamar a addToHistory cuando se reproduce (modificar playVideoById)
            const originalPlay = playVideoById;
            playVideoById = function(id) {
                addToHistory(id);
                originalPlay(id);
            };
            // Sobrescribir
            window.playVideoById = playVideoById;

            // Exponer funciones globales si es necesario
        })();
    </script>
</body>
</html>
